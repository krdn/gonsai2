# =============================================================================
# 스테이징 환경 변수
# =============================================================================
# 프로덕션 배포 전 테스트 환경용 설정
# =============================================================================

# -----------------------------------------------------------------------------
# Application Configuration
# -----------------------------------------------------------------------------
NODE_ENV=staging
PORT=3000
APP_NAME=gonsai2-staging
APP_URL=https://staging.yourdomain.com

# -----------------------------------------------------------------------------
# n8n Configuration
# -----------------------------------------------------------------------------
N8N_API_URL=http://n8n:5678
N8N_WEBHOOK_URL=https://staging.yourdomain.com/webhook
N8N_API_KEY=staging-api-key-change-me

N8N_HOST=n8n-staging.yourdomain.com
N8N_PROTOCOL=https
N8N_PORT=5678

# 스테이징 암호화 키 (프로덕션과 다른 키 사용)
N8N_ENCRYPTION_KEY=staging-encryption-key-32-chars
N8N_JWT_SECRET=staging-jwt-secret-change-me

EXECUTIONS_MODE=queue
EXECUTIONS_DATA_MAX_AGE=168
EXECUTIONS_DATA_PRUNE=true

# -----------------------------------------------------------------------------
# Database Configuration - PostgreSQL
# -----------------------------------------------------------------------------
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=n8n_staging
POSTGRES_USER=n8n_staging
POSTGRES_PASSWORD=staging-postgres-password

POSTGRES_MAX_CONNECTIONS=50
POSTGRES_SHARED_BUFFERS=128MB
POSTGRES_EFFECTIVE_CACHE_SIZE=512MB

# -----------------------------------------------------------------------------
# Database Configuration - MongoDB
# -----------------------------------------------------------------------------
MONGO_ROOT_USER=staging_admin
MONGO_ROOT_PASSWORD=staging-mongo-password
MONGO_DATABASE=gonsai2_staging
MONGO_AUTH_SOURCE=admin

MONGODB_URI=mongodb://staging_admin:staging-mongo-password@mongodb:27017/gonsai2_staging?authSource=admin

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=staging-redis-password
REDIS_DB=0
REDIS_URL=redis://:staging-redis-password@redis:6379/0

REDIS_MAX_MEMORY=1gb
REDIS_MAX_MEMORY_POLICY=allkeys-lru

# -----------------------------------------------------------------------------
# Security & Authentication
# -----------------------------------------------------------------------------
JWT_SECRET=staging-jwt-secret-min-32-chars-long
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d

ENCRYPTION_KEY=staging-encryption-32-bytes-key

SESSION_SECRET=staging-session-secret
SESSION_MAX_AGE=604800000

CORS_ORIGIN=https://staging.yourdomain.com

# -----------------------------------------------------------------------------
# Monitoring - Prometheus
# -----------------------------------------------------------------------------
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION_TIME=15d

# -----------------------------------------------------------------------------
# Monitoring - Grafana
# -----------------------------------------------------------------------------
GRAFANA_PORT=3001
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=staging-grafana-password
GRAFANA_ROOT_URL=https://grafana-staging.yourdomain.com
GRAFANA_SMTP_ENABLED=false

# -----------------------------------------------------------------------------
# Logging - Loki
# -----------------------------------------------------------------------------
LOKI_PORT=3100
LOKI_RETENTION_PERIOD=360h

# -----------------------------------------------------------------------------
# Alerting
# -----------------------------------------------------------------------------
ALERTMANAGER_PORT=9093
ALERT_EMAIL_TO=staging-alerts@yourdomain.com
ALERT_EMAIL_FROM=noreply-staging@yourdomain.com
ALERT_SLACK_WEBHOOK_URL=

# -----------------------------------------------------------------------------
# SSL/TLS Configuration
# -----------------------------------------------------------------------------
SSL_CERT_PATH=/etc/nginx/ssl/staging-cert.pem
SSL_KEY_PATH=/etc/nginx/ssl/staging-key.pem
SSL_DHPARAM_PATH=/etc/nginx/ssl/dhparam.pem

LETSENCRYPT_EMAIL=admin@yourdomain.com
LETSENCRYPT_DOMAIN=staging.yourdomain.com

# -----------------------------------------------------------------------------
# Backup Configuration (스테이징 - 짧은 보관기간)
# -----------------------------------------------------------------------------
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 3 * * *
BACKUP_RETENTION_DAYS=7
BACKUP_S3_BUCKET=your-staging-backup-bucket
BACKUP_S3_REGION=ap-northeast-2
BACKUP_S3_ACCESS_KEY=
BACKUP_S3_SECRET_KEY=

# -----------------------------------------------------------------------------
# Email Configuration
# -----------------------------------------------------------------------------
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=staging-email@gmail.com
SMTP_PASSWORD=staging-smtp-password
EMAIL_FROM=noreply-staging@yourdomain.com

# -----------------------------------------------------------------------------
# Timezone
# -----------------------------------------------------------------------------
TIMEZONE=Asia/Seoul
TZ=Asia/Seoul

# -----------------------------------------------------------------------------
# Resource Limits (스테이징 - 프로덕션보다 작음)
# -----------------------------------------------------------------------------
NODE_OPTIONS=--max-old-space-size=1536
WEB_CONCURRENCY=1

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
ENABLE_METRICS=true
ENABLE_TRACING=true
ENABLE_DEBUG_LOGS=true
ENABLE_API_DOCS=true

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=200

# -----------------------------------------------------------------------------
# File Upload
# -----------------------------------------------------------------------------
MAX_FILE_SIZE=10485760
UPLOAD_DIR=/tmp/uploads

# -----------------------------------------------------------------------------
# Cache Configuration
# -----------------------------------------------------------------------------
CACHE_TTL=1800
CACHE_MAX_ITEMS=500

# -----------------------------------------------------------------------------
# Webhook Configuration
# -----------------------------------------------------------------------------
WEBHOOK_TIMEOUT=30000
WEBHOOK_MAX_PAYLOAD_SIZE=5242880

# -----------------------------------------------------------------------------
# Worker Configuration
# -----------------------------------------------------------------------------
WORKER_CONCURRENCY=5
WORKER_MAX_JOBS_PER_WORKER=25

# -----------------------------------------------------------------------------
# Health Check Configuration
# -----------------------------------------------------------------------------
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3

# -----------------------------------------------------------------------------
# Development/Debug (스테이징 - 일부 디버깅 활성화)
# -----------------------------------------------------------------------------
DEBUG=false
VERBOSE_LOGGING=true
STACK_TRACE_LIMIT=25
